# Shrimp Service Docker Deployment

åŸºäº MongoDB çš„ Shrimp æœåŠ¡ä¸å‰ç«¯é¡µé¢çš„ Docker éƒ¨ç½²æ–¹æ¡ˆã€‚

## ğŸ—ï¸ æ¶æ„

æœ¬éƒ¨ç½²æ–¹æ¡ˆåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

- **MongoDB 7.0**: æ•°æ®åº“æœåŠ¡
- **Shrimp API**: FastAPI åç«¯æœåŠ¡ (ç«¯å£ 4444)
- **Frontend**: React å‰ç«¯åº”ç”¨
- **Nginx**: åå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡ (ç«¯å£ 80)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡ç¯å¢ƒ

ç¡®ä¿å·²å®‰è£…ï¼š
- Docker
- Docker Compose

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

```

### 3. å¯åŠ¨æœåŠ¡

ä½¿ç”¨ä¾¿æ·çš„éƒ¨ç½²è„šæœ¬ï¼š

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
./deploy.sh up

# æˆ–è€…ä½¿ç”¨ docker-compose
docker-compose up -d
```

### 4. è®¿é—®æœåŠ¡

- **å‰ç«¯é¡µé¢**: http://localhost:80
- **API æ–‡æ¡£**: http://localhost:4444/docs
- **MongoDB**: localhost:27017

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

```bash
# æ„å»ºé•œåƒ
./deploy.sh build

# å¯åŠ¨æœåŠ¡
./deploy.sh up

# åœæ­¢æœåŠ¡
./deploy.sh down

# é‡å¯æœåŠ¡
./deploy.sh restart

# æŸ¥çœ‹æ—¥å¿—
./deploy.sh logs

# æŸ¥çœ‹çŠ¶æ€
./deploy.sh status
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
.
â”œâ”€â”€ Dockerfile              # åº”ç”¨å®¹å™¨æ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml      # æœåŠ¡ç¼–æ’é…ç½®
â”œâ”€â”€ deploy.sh               # éƒ¨ç½²ç®¡ç†è„šæœ¬
â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .dockerignore           # Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
â””â”€â”€ docker/
    â””â”€â”€ mongo-init/
        â””â”€â”€ init-mcp-db.js  # MongoDB åˆå§‹åŒ–è„šæœ¬
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### MongoDB é…ç½®

é»˜è®¤ MongoDB é…ç½®ï¼š(ä¸æ ¡éªŒ)
- ç”¨æˆ·å: `admin`
- å¯†ç : `password`
- æ•°æ®åº“: `mcp_db`

å¯ä»¥åœ¨ `.env` æ–‡ä»¶ä¸­ä¿®æ”¹è¿™äº›é…ç½®ã€‚

### ç«¯å£é…ç½®

- **80**: Nginx (å‰ç«¯ + API ä»£ç†)
- **4444**: Shrimp API ç›´æ¥è®¿é—®
- **27017**: MongoDB

### æ•°æ®æŒä¹…åŒ–

MongoDB æ•°æ®å­˜å‚¨åœ¨ Docker volume `mongodb_data` ä¸­ï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–ã€‚

## ğŸ› æ•…éšœæ’é™¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
docker-compose ps
```

### æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—

```bash
# æŸ¥çœ‹ MongoDB æ—¥å¿—
docker-compose logs mongodb

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs shrimp-app
```

### é‡ç½®æ•°æ®åº“

```bash
# åœæ­¢æœåŠ¡
./deploy.sh down

# åˆ é™¤æ•°æ®å·
docker volume rm wr124_mongodb_data

# é‡æ–°å¯åŠ¨
./deploy.sh up
```

### è¿›å…¥å®¹å™¨è°ƒè¯•

```bash
# è¿›å…¥åº”ç”¨å®¹å™¨
docker-compose exec shrimp-app bash

# è¿›å…¥ MongoDB å®¹å™¨
docker-compose exec mongodb mongosh
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **æ›´æ”¹é»˜è®¤å¯†ç **: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒåŠ¡å¿…ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„é»˜è®¤å¯†ç 
2. **SECRET_KEY**: ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ä½œä¸º SECRET_KEY
3. **ç½‘ç»œå®‰å…¨**: æ ¹æ®éœ€è¦è°ƒæ•´ç«¯å£æš´éœ²å’Œé˜²ç«å¢™è§„åˆ™
4. **SSL/TLS**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½® HTTPS

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

- æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨ `./logs` ç›®å½•ä¸­
- å¥åº·æ£€æŸ¥å·²é…ç½®ï¼Œå¯é€šè¿‡ `docker-compose ps` æŸ¥çœ‹çŠ¶æ€
- ä½¿ç”¨ `./deploy.sh status` å¿«é€Ÿæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š

1. ä½¿ç”¨ä¸“ç”¨çš„ MongoDB é›†ç¾¤
2. é…ç½® SSL/TLS è¯ä¹¦
3. è®¾ç½®é€‚å½“çš„èµ„æºé™åˆ¶
4. é…ç½®æ—¥å¿—è½®è½¬
5. è®¾ç½®ç›‘æ§å’Œå‘Šè­¦
6. å®šæœŸå¤‡ä»½æ•°æ®åº“

## ğŸ“ å¼€å‘æ¨¡å¼

å¦‚éœ€å¼€å‘æ¨¡å¼ï¼Œå¯ä»¥ï¼š

```bash
# è®¾ç½®å¼€å‘ç¯å¢ƒå˜é‡
echo "DEBUG=true" >> .env

# é‡å¯æœåŠ¡
./deploy.sh restart
```
